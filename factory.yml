- job-template:
    name: 'fedora-{plugin}'
    wrappers:
      - workspace-cleanup
    scm:
      - git:
          url: https://github.com/Spredzy/vimfactory.org
          basedir: '{plugin}'
          clean:
            before: True
    builders:
      - shell: |
          rpmdev-setuptree
          wget -O $HOME/rpmbuild/SOURCES/{version}.tar.gz {url}/archive/{version}.tar.gz
          cp $WORKSPACE/{plugin}/specs/{plugin}/{plugin}.spec ~/rpmbuild/SPECS
          rpmbuild -bs $HOME/rpmbuild/SPECS/{plugin}.spec
          mock --rebuild --root=fedora-26-x86_64 --resultdir=$WORKSPACE '/var/lib/jenkins/rpmbuild/SRPMS/{plugin}-{version}-1.el7.centos.src.rpm'
          # Copy the files where they belong and refresh the repo with newer metadata
          sudo mkdir -p '/var/www/html/repo.vimfactory.org/{plugin}/'
          sudo cp $WORKSPACE/*.log $WORKSPACE/*.rpm $WORKSPACE/{plugin}/specs/{plugin}/{plugin}.spec '/var/www/html/repo.vimfactory.org/{plugin}/'
          ls $WORKSPACE | grep '[^src].rpm' | xargs -I [] bash -c "sudo cp [] /var/www/html/repo.vimfactory.org/repos/26/x86_64/"
          sudo createrepo --update /var/www/html/repo.vimfactory.org/repos/26/x86_64/


- project:
    name: vimfactory.org
    jobs:
      - 'fedora-{plugin}':
         plugin: vim-licenses
         url: https://github.com/antoyo/vim-licenses
         version: v0.5

      - 'fedora-{plugin}':
         plugin: vim-commentary
         url: https://github.com/tpope/vim-commentary
         version: v1.3

      - 'fedora-{plugin}':
         plugin: Gist.vim
         url: https://github.com/mattn/gist-vim
         version: 7.3
