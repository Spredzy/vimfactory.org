- job-template:
    name: 'fedora-{plugin}'
    wrappers:
      - workspace-cleanup
    scm:
      - git:
          url: https://github.com/Spredzy/vimfactory.org
          basedir: '{plugin}'
          clean:
            before: True
    builders:
      - shell: |
          rpmdev-setuptree
          wget -O $HOME/rpmbuild/SOURCES/{version}.tar.gz {url}/archive/{version}.tar.gz
          cp $WORKSPACE/{plugin}/specs/{plugin}/{plugin}.spec ~/rpmbuild/SPECS
          SRPM_FILE=$(rpmbuild -bs $HOME/rpmbuild/SPECS/{plugin}.spec | cut -d" " -f2)
          mock --rebuild --root=fedora-26-x86_64 --resultdir=$WORKSPACE $SRPM_FILE
          # Copy the files where they belong and refresh the repo with newer metadata
          sudo mkdir -p '/var/www/html/repo.vimfactory.org/{plugin}/'
          sudo cp $WORKSPACE/*.log $WORKSPACE/*.rpm '/var/www/html/repo.vimfactory.org/{plugin}/'
          sudo cp $WORKSPACE/{plugin}/specs/{plugin}/{plugin}.spec '/var/www/html/repo.vimfactory.org/{plugin}/{plugin}.spec'
          ls $WORKSPACE | grep '[^src].rpm' | xargs -I [] bash -c "sudo cp [] /var/www/html/repo.vimfactory.org/repos/26/x86_64/"
          sudo createrepo --update /var/www/html/repo.vimfactory.org/repos/26/x86_64/

- project:
    name: vimfactory.org
    jobs:
      - 'fedora-{plugin}':
         plugin: vim-licenses
         url: https://github.com/antoyo/vim-licenses
         version: v0.5

      - 'fedora-{plugin}':
         plugin: vim-commentary
         url: https://github.com/tpope/vim-commentary
         version: v1.3

      - 'fedora-{plugin}':
         plugin: vim-auto-pairs
         url: https://github.com/jiangmiao/auto-pairs
         version: v1.3.1

      - 'fedora-{plugin}':
         plugin: vim-gitgutter
         url: https://github.com/Spredzy/vim-gitgutter
         version: v1.0

      - 'fedora-{plugin}':
         plugin: vim-gv
         url: https://github.com/Spredzy/gv.vim
         version: v1.0
